# Name of your GitHub Actions workflow.
name: Build & Publish to GitHub Pages

# Specifies to run this workflow whenever a push is made (commits are
# added) to the branch named `jekyll`.
on:
  push:
    branches:
      # Change this to the branch where you keep your Jekyll code.
      - master

# Define a job named `build-and-publish` in your workflow.
jobs:
  build-and-publish:
    runs-on: ubuntu-latest # This job uses a GitHub-hosted runner.

    steps:
      # Checkout the source from the `jekyll` branch.
      - name: Check out Site Repository
        uses: actions/checkout@v2
      - name: Check out Model Repository
        uses: actions/checkout@v2
        with:
          # Repository name with owner. For example, actions/checkout
          # Default: ${{ github.repository }}
          repository: 'AKSW/aksw.org-model'
          path: 'aksw-model'
      - run: ls -la
      - run: docker network create data
      - name: Run Fuseki
        run: docker run -v ${{ github.workspace }}/aksw-model:/staging --network data --hostname fuseki --name fuseki -d stain/jena-fuseki /jena-fuseki/fuseki-server --file=/staging/aksw.org.nt /aksw
      - run: docker run --rm --network data curlimages/curl:latest http://fuseki:3030/aksw
        continue-on-error: true
      - run: docker run --rm --network data --workdir /github/workspace -v ${{ github.workspace }}:/github/workspace jekyll/builder jekyll build
      - name: Deploy ðŸš€
        uses: JamesIves/github-pages-deploy-action@3.7.1
        with:
          GITHUB_TOKEN: ${{ secrets.GH_PAGES_TOKEN }}
          BRANCH: gh-pages # The branch the action should deploy to.
          FOLDER: _site # The folder the action should deploy.
          CLEAN: true # Automatically remove deleted files from the deploy branch
